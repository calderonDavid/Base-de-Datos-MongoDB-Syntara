db.createCollection("carts", {
   validator: {
      $jsonSchema: {
         bsonType: "object",
         required: ["userId", "items"],
         properties: {
            userId: {
               bsonType: "objectId",
               description: "Debe ser un ObjectId y es obligatorio (referencia a User)"
            },
            updatedAt: {
               bsonType: "date",
               description: "Fecha de última actualización"
            },
            items: {
               bsonType: "array",
               description: "Lista de productos en el carrito",
               items: {
                  bsonType: "object",
                  required: ["product", "price", "store"],
                  properties: {
                     productId: {
                        bsonType: ["string", "null"],
                        description: "ID original del producto (puede ser null)"
                     },
                     product: {
                        bsonType: "string",
                        description: "Nombre del producto (requerido)"
                     },
                     price: {
                        bsonType: ["double", "int", "long", "decimal"],
                        description: "Precio del producto (requerido, numérico)"
                     },
                     store: {
                        bsonType: "string",
                        description: "Tienda donde se vende (requerido)"
                     },
                     quantity: {
                        bsonType: ["double", "int", "long", "decimal"],
                        description: "Cantidad a comprar (numérico)"
                     },
                     unit: {
                        bsonType: "string",
                        description: "Unidad de medida (ej: 'unidad', 'kg')"
                     },
                     url: {
                        bsonType: ["string", "null"],
                        description: "Enlace al producto"
                     },
                     addedAt: {
                        bsonType: "date",
                        description: "Fecha en que se agregó al carrito"
                     }
                  }
               }
            }
         }
      }
   }
});
db.carts.createIndex({ "userId": 1 }, { unique: true });


